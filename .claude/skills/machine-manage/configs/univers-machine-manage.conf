# Univers Machine Manage Tmux Style Configuration
# 物理机管理会话的 tmux 样式配置
# 用于 univers-machine-manage - 机器管理界面
#
# NOTE: This config sets GLOBAL defaults for base settings and keybindings
# that apply to all sessions. The visual styles are session-specific to avoid conflicts.

# ============================================
# 基础设置 - GLOBAL (applies to all sessions)
# ============================================
set -g default-terminal "screen-256color"
set -g history-limit 50000
set -g mouse on

# 窗口和面板索引从 0 开始
set -g base-index 0
setw -g pane-base-index 1

# ============================================
# 状态栏配置 - SESSION SPECIFIC (only for univers-machine-manage)
# ============================================
set -t univers-machine-manage status on
set -t univers-machine-manage status-interval 5
set -t univers-machine-manage status-position bottom
set -t univers-machine-manage status-justify left

# 状态栏颜色 - 绿色系（管理会话）
set -t univers-machine-manage status-style bg=colour234,fg=colour46

# ============================================
# 左侧状态栏 - 显示管理信息
# ============================================
set -t univers-machine-manage status-left-length 50
set -t univers-machine-manage status-left '#[fg=colour46,bold]⚙️  Machine Manage #[fg=colour34]| #[fg=colour117]#S #[fg=colour34]| '

# ============================================
# 右侧状态栏 - 显示系统信息
# ============================================
set -t univers-machine-manage status-right-length 60
set -t univers-machine-manage status-right '#[fg=colour34]Windows:#[fg=colour117,bold]#{window_index}#[fg=colour34]/#{session_windows} #[fg=colour34]| #[fg=colour46]#{window_name} #[fg=colour34]| #[fg=colour75]%H:%M'

# ============================================
# 窗口状态样式 - SESSION SPECIFIC
# ============================================
# 非活动窗口 - 灰绿色
set -t univers-machine-manage window-status-format '#[fg=colour35] #I:#W '

# 当前窗口 - 亮绿色加粗 + 勾号
set -t univers-machine-manage window-status-current-format '#[fg=colour46,bold] #I:#W #[fg=colour34]✓'

# 窗口活动通知 - 青色
set -t univers-machine-manage window-status-activity-style fg=colour51,bg=colour234

# ============================================
# 面板边框 - SESSION SPECIFIC
# ============================================
set -t univers-machine-manage pane-border-style fg=colour238
set -t univers-machine-manage pane-active-border-style fg=colour46

# ============================================
# 消息样式 - SESSION SPECIFIC
# ============================================
set -t univers-machine-manage message-style fg=colour232,bg=colour46,bold

# ============================================
# 时钟模式 - SESSION SPECIFIC
# ============================================
set -t univers-machine-manage clock-mode-colour colour46

# ============================================
# 状态栏格式 - SESSION SPECIFIC
# 必须明确设置 status-format 以支持鼠标点击窗口列表
# ============================================
set -t univers-machine-manage status-format[0] '#[align=left range=left #{E:status-left-style}]#[push-default]#{T;=/#{status-left-length}:status-left}#[pop-default]#[norange default]#[list=on align=#{status-justify}]#[list=left-marker]<#[list=right-marker]>#[list=on]#{W:#[range=window|#{window_index} #{E:window-status-style}#{?#{&&:#{window_last_flag},#{!=:#{E:window-status-last-style},default}}, #{E:window-status-last-style},}#{?#{&&:#{window_bell_flag},#{!=:#{E:window-status-bell-style},default}}, #{E:window-status-bell-style},#{?#{&&:#{||:#{window_activity_flag},#{window_silence_flag}},#{!=:#{E:window-status-activity-style},default}}, #{E:window-status-activity-style},}}]#[push-default]#{T:window-status-format}#[pop-default]#[norange default]#{?window_end_flag,,#{window-status-separator}},#[range=window|#{window_index} list=focus #{?#{!=:#{E:window-status-current-style},default},#{E:window-status-current-style},#{E:window-status-style}}#{?#{&&:#{window_last_flag},#{!=:#{E:window-status-last-style},default}}, #{E:window-status-last-style},}#{?#{&&:#{window_bell_flag},#{!=:#{E:window-status-bell-style},default}}, #{E:window-status-bell-style},#{?#{&&:#{||:#{window_activity_flag},#{window_silence_flag}},#{!=:#{E:window-status-activity-style},default}}, #{E:window-status-activity-style},}}]#[push-default]#{T:window-status-current-format}#[pop-default]#[norange list=on default]#{?window_end_flag,,#{window-status-separator}}}#[nolist align=right range=right #{E:status-right-style}]#[push-default]#{T;=/#{status-right-length}:status-right}#[pop-default]#[norange default]'
set -t univers-machine-manage status-format[1] '#[align=centre]#{P:#{?pane_active,#[reverse],}#{pane_index}[#{pane_width}x#{pane_height}]#[default] }'

# ============================================
# 快捷键绑定 - GLOBAL (applies to all sessions)
# Machine 层使用 Ctrl+H/L 切换窗口（容器内使用 Ctrl+Y/U）
# ============================================
# Ctrl+H/L 快速切换窗口
bind-key -n C-h previous-window
bind-key -n C-l next-window

# Ctrl+N/P 快速切换窗口
bind-key -n C-n next-window
bind-key -n C-p previous-window

# Alt+数字 直接跳转窗口
bind-key -n M-0 select-window -t 0
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5

# Ctrl+j/k 滚动
bind-key -n C-k copy-mode \; send-keys -X -N 5 scroll-up
bind-key -T copy-mode-vi C-k send-keys -X -N 5 scroll-up
bind-key -T copy-mode C-k send-keys -X -N 5 scroll-up

bind-key -T copy-mode-vi C-j send-keys -X -N 5 scroll-down \; if-shell -F "#{==:#{scroll_position},0}" "send-keys -X cancel" ""
bind-key -T copy-mode C-j send-keys -X -N 5 scroll-down \; if-shell -F "#{==:#{scroll_position},0}" "send-keys -X cancel" ""

# ============================================
# 管理会话专用快捷键 - DISABLED to avoid accidental triggers
# ============================================
# Ctrl+R - 刷新机器视图 (已禁用)
# bind-key -n C-r run-shell 'cd #{pane_current_path} && ./.claude/skills/machine-manage/scripts/machine-view-manager.sh refresh'

# Ctrl+S - 显示状态 (已禁用)
# bind-key -n C-s run-shell 'cd #{pane_current_path} && ./.claude/skills/machine-manage/scripts/machine-view-manager.sh status'

# Ctrl+U - 更新容器代码 (已禁用)
# bind-key -n C-u run-shell 'cd #{pane_current_path} && ./.claude/skills/machine-manage/scripts/machine-view-manager.sh update'

# Ctrl+M - 管理会话操作 (已禁用，避免误触)
# bind-key -n C-m command-prompt -p 'Manage command:' 'run-shell "cd #{pane_current_path} && ./.claude/skills/machine-manage/scripts/machine-view-manager.sh manage %%"'

# ============================================
# 快捷键绑定
# Machine Manage 会话专用快捷键
# ============================================
# Ctrl+H/L 快速切换窗口
bind-key -n C-h previous-window
bind-key -n C-l next-window

# Alt+数字 直接跳转窗口
bind-key -n M-0 select-window -t 0
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5

# Ctrl+j/k 滚动
bind-key -n C-k copy-mode \; send-keys -X -N 5 scroll-up
bind-key -T copy-mode-vi C-k send-keys -X -N 5 scroll-up
bind-key -T copy-mode C-k send-keys -X -N 5 scroll-up

bind-key -T copy-mode-vi C-j send-keys -X -N 5 scroll-down \; if-shell -F "#{==:#{scroll_position},0}" "send-keys -X cancel" ""
bind-key -T copy-mode C-j send-keys -X -N 5 scroll-down \; if-shell -F "#{==:#{scroll_position},0}" "send-keys -X cancel" ""

# ============================================
# 管理会话专用快捷键
# ============================================
# Ctrl+R - 刷新机器视图
bind-key -n C-r run-shell 'cd #{pane_current_path} && ./.claude/skills/machine-manage/scripts/machine-view-manager.sh refresh'

# Ctrl+S - 显示状态
bind-key -n C-s run-shell 'cd #{pane_current_path} && ./.claude/skills/machine-manage/scripts/machine-view-manager.sh status'

# Ctrl+U - 更新容器代码
bind-key -n C-u run-shell 'cd #{pane_current_path} && ./.claude/skills/machine-manage/scripts/machine-view-manager.sh update'

# Ctrl+M - 管理会话操作 (已禁用，避免误触)
# bind-key -n C-m command-prompt -p 'Manage command:' 'run-shell "cd #{pane_current_path} && ./.claude/skills/machine-manage/scripts/machine-view-manager.sh manage %%"'