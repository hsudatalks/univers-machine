# Univers Machine Manage Tmux Style Configuration
# 物理机管理会话的 tmux 样式配置
# 用于 univers-machine-manage - 机器管理界面
#
# NOTE: This config sets GLOBAL defaults for base settings and keybindings
# that apply to all sessions. The visual styles are session-specific to avoid conflicts.

# ============================================
# 基础设置 - GLOBAL (applies to all sessions)
# ============================================
set -g default-terminal "screen-256color"
set -g history-limit 50000
set -g mouse on

# 窗口和面板索引从 0 开始
set -g base-index 0
setw -g pane-base-index 1

# ============================================
# 状态栏配置 - SESSION SPECIFIC (only for univers-machine-manage)
# ============================================
set -t univers-machine-manage status on
set -t univers-machine-manage status-interval 5
set -t univers-machine-manage status-position bottom
set -t univers-machine-manage status-justify left

# 状态栏颜色 - 简洁灰色系
set -t univers-machine-manage status-style bg=colour234,fg=colour244

# ============================================
# 左侧状态栏 - 空（不显示窗口列表）
# ============================================
set -t univers-machine-manage status-left-length 0
set -t univers-machine-manage status-left ''

# ============================================
# 右侧状态栏 - 简洁的 Git 状态
# 格式：分支 ↑本地提交数 ±改动文件数
# ============================================
set -t univers-machine-manage status-right-length 60
set -t univers-machine-manage status-right '#[fg=colour33]#(git -C #{pane_current_path} branch --show-current 2>/dev/null | cut -c1-25) #[fg=colour75]↑#(git -C #{pane_current_path} rev-list --count @{u}..HEAD 2>/dev/null || echo 0) #[fg=colour226]±#(git -C #{pane_current_path} status --short 2>/dev/null | wc -l | tr -d " ")'

# ============================================
# 窗口状态样式 - SESSION SPECIFIC (简洁版)
# ============================================
# 非活动窗口 - 灰色
set -t univers-machine-manage window-status-format '#[fg=colour244] #I:#W '

# 当前窗口 - 白色加粗
set -t univers-machine-manage window-status-current-format '#[fg=colour255,bold] #I:#W '

# 窗口活动通知 - 黄色
set -t univers-machine-manage window-status-activity-style fg=colour226,bg=colour234

# ============================================
# 面板边框 - SESSION SPECIFIC (低调灰色)
# ============================================
set -t univers-machine-manage pane-border-style fg=colour238
set -t univers-machine-manage pane-active-border-style fg=colour244

# ============================================
# 消息样式 - SESSION SPECIFIC (低调)
# ============================================
set -t univers-machine-manage message-style fg=colour255,bg=colour238,bold

# ============================================
# 时钟模式 - SESSION SPECIFIC (低调)
# ============================================
set -t univers-machine-manage clock-mode-colour colour244

# ============================================
# 状态栏格式 - SESSION SPECIFIC (简洁版，无窗口列表)
# ============================================
set -t univers-machine-manage status-format[0] '#[align=left range=left #{E:status-left-style}]#[push-default]#{T;=/#{status-left-length}:status-left}#[pop-default]#[norange default]#[nolist align=right range=right #{E:status-right-style}]#[push-default]#{T;=/#{status-right-length}:status-right}#[pop-default]#[norange default]'
set -t univers-machine-manage status-format[1] '#[align=centre]#{P:#{?pane_active,#[reverse],}#{pane_index}[#{pane_width}x#{pane_height}]#[default] }'

# ============================================
# 快捷键绑定 - GLOBAL (applies to all sessions)
# 
# 快捷键层级设计：
# - machine-mobile-view 会话：Ctrl+H/L 切换窗口
# - mobile-dev 会话（本机）：Ctrl+N/P 切换窗口
# - 容器内 container-*-view：Ctrl+Y/U 切换窗口
# ============================================

# Ctrl+H/L - machine-view 窗口切换（用于 machine-mobile-view, machine-desktop-view）
bind-key -n C-h previous-window
bind-key -n C-l next-window

# Ctrl+N/P - 辅助窗口切换（用于 mobile-dev 等聚合会话）
bind-key -n C-n next-window
bind-key -n C-p previous-window

# 移除 Ctrl+Y/U 绑定（由 container view 专用）
unbind-key -n C-y
unbind-key -n C-u

# Alt+数字 - 直接跳转窗口（所有会话通用）
bind-key -n M-0 select-window -t 0
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5

# Ctrl+K - 向上滚动（所有会话通用）
bind-key -n C-k copy-mode \; send-keys -X -N 5 scroll-up
bind-key -T copy-mode-vi C-k send-keys -X -N 5 scroll-up
bind-key -T copy-mode C-k send-keys -X -N 5 scroll-up

# Ctrl+J - 向下滚动（所有会话通用）
bind-key -T copy-mode-vi C-j send-keys -X -N 5 scroll-down \; if-shell -F "#{==:#{scroll_position},0}" "send-keys -X cancel" ""
bind-key -T copy-mode C-j send-keys -X -N 5 scroll-down \; if-shell -F "#{==:#{scroll_position},0}" "send-keys -X cancel" ""